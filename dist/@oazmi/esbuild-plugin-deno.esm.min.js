function xt(e,t,r){let o=r===void 0?t:t.bind(r),n=e.length-1;for(;n>=0;){if(o(e[n],n,e))return n;n--}return-1}function yt(e,t,r){let o=e.findLastIndex(t,r);return o===-1?void 0:e[o]}Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e,t){return xt(this,e,t)});Array.prototype.findLast||(Array.prototype.findLast=function(e,t){return yt(this,e,t)});Uint8Array.prototype.findLastIndex||(Uint8Array.prototype.findLastIndex=function(e,t){return xt(this,e,t)});Uint8Array.prototype.findLast||(Uint8Array.prototype.findLast=function(e,t){return yt(this,e,t)});var Qt={},bt=er(globalThis,Qt);function er(e,t){return new Proxy(e,{get(r,o,n){return o in t?t[o]:e[o]},set(r,o,n){return o in t&&delete t[o],e[o]=n,!0},deleteProperty(r,o){let n=!1;return o in t&&(delete t[o],n=!0),o in e&&(delete e[o],n=!0),n},ownKeys(r){let o=Reflect.ownKeys(e),n=Reflect.ownKeys(t),s=new Set(n);return[...o.filter(i=>!s.has(i)),...n]},defineProperty(r,o,n){return o in t&&delete t[o],Reflect.defineProperty(e,o,n),!0},getOwnPropertyDescriptor(r,o){return o in t?Reflect.getOwnPropertyDescriptor(t,o):Reflect.getOwnPropertyDescriptor(e,o)},has(r,o){return o in t||o in e}})}var rr=JSON;var Te=Object;var wt=Symbol;var Q=rr.stringify;var $e=Te.assign;var O=Te.entries;var Le=Te.keys;var De=wt.iterator;var Et=wt.toStringTag;var ue=encodeURI;var Pt=decodeURI;var P;(function(e){e[e.LOG=0]="LOG",e[e.ASSERT=0]="ASSERT",e[e.ERROR=1]="ERROR",e[e.PRODUCTION=1]="PRODUCTION",e[e.MINIFY=1]="MINIFY"})(P||(P={}));var A=(e,t,...r)=>o=>e[t].bind(o,...r);var fe=(e,t,...r)=>e[t].bind(e,...r),Rt=e=>e.prototype;var U=Rt(Map),Fe=Rt(Set);var Ue=A(Fe,"add");var ze=A(Fe,"delete");var We=A(Fe,"has");var Be=A(U,"delete"),Ve=A(U,"entries"),He=A(U,"forEach"),de=A(U,"get"),Ke=A(U,"has"),Xe=A(U,"keys"),Je=A(U,"set"),Ge=A(U,"values");var he=e=>{let t=typeof e;return t==="object"||t==="function"};var _e=e=>typeof e=="object";var R=e=>typeof e=="string";var ar=/[.*+?^${}()|[\]\\]/g,qe=e=>e.replaceAll(ar,"\\$&"),z=(e,t,r="")=>e.startsWith(t)?r+e.slice(t.length):void 0,ge=(e,t,r="")=>e.endsWith(t)?(t===""?e:e.slice(0,-t.length))+r:void 0;var pr=O({"node:":"node","npm:":"npm","jsr:":"jsr","blob:":"blob","data:":"data","http://":"http","https://":"https","file://":"file","./":"relative","../":"relative"}),cr=["blob","data","relative"],lr=["jsr","npm","node"],mr=["jsr:","npm:","node:"],C="/",xe="./",Ye="../",ur=/\\/g,fr=/^[a-z]\:[\/\\]/i,dr=/^\/+/;var hr=/\/?[^\/]+$/,_r=/^(?<basename>.+?)(?<ext>\.[^\.]+)?$/,gr=/^(?<protocol>jsr:|npm:|node:)(\/*(@(?<scope>[^\/\s]+)\/)?(?<pkg>[^@\/\s]+)(@(?<version>[^\/\r\n\t\f\v]+))?)?(?<pathname>\/.*)?$/,K=(e,t)=>e.startsWith(t),Nt=(e,t)=>e.endsWith(t),Ze=e=>K(e,C)||K(e,"~")||fr.test(e),ye=e=>{if(!(!e||e==="")){for(let[t,r]of pr)if(K(e,t))return r;return Ze(e)?"local":"relative"}},T=e=>{e=Pt(R(e)?e:e.href);let{protocol:t,scope:r,pkg:o,version:n,pathname:s}=gr.exec(e)?.groups??{};if(t===void 0||o===void 0)throw new Error(P.ERROR?"invalid package url format was provided: "+e:"");let i=r||void 0,a=n||void 0,p=s||C,c=`${i?"@"+i+C:""}${o}${a?"@"+a:""}`,m=ue(`${t}/${c}${p}`);return{protocol:t,scope:i,pkg:o,version:a,pathname:p,host:c,href:m}},v=(e,t)=>{if(!R(e))return e;e=S(e);let r=t;if(R(t)){let s=ye(t);if(cr.includes(s))throw new Error(P.ERROR?"the following base scheme (url-protocol) is not supported: "+s:"");r=v(t)}let o=ye(e),n=lr.includes(o);if(o==="local")return new URL("file://"+ue(e));if(n)return new URL(T(e).href);if(o==="relative"){let s=r?r.protocol:void 0;if(!mr.includes(s))return new URL(ue(e),r);let{protocol:a,host:p,pathname:c}=T(r),m=new URL(e,"x:"+c).pathname;e=`${a}/${p}${m}`}return new URL(e)},xr=e=>e.replace(dr,"");var X=e=>K(e,xe)?e:K(e,C)?"."+e:xe+e,k=e=>Nt(e,C)?e:e+C;var Mt=(e,t={})=>{let{keepRelative:r=!0}=_e(t)?t:{},o=e.split(C),n=o.at(-1),s=[".."],i=r&&o[0]===".";o.length>=2&&(n==="."||n==="..")&&o.push("");for(let p of o)p===".."?s.at(-1)!==".."?s.pop():s.push(p):p!=="."&&s.push(p);return s.shift(),i&&s[0]!==".."&&s.unshift("."),s.join(C)},ae=(e,t)=>Mt(S(e),t),S=e=>e.replaceAll(ur,C);var jt=e=>xr(hr.exec(e)?.[0]??""),yr=e=>{let{basename:t="",ext:r=""}=_r.exec(e)?.groups??{};return[t,r]},Qe=e=>{let t=ae(e),r=jt(t),o=r.length,n=o>0?t.slice(0,-o):t,s=jt(n.slice(0,-1)),[i,a]=yr(r);return{path:t,dirpath:n,dirname:s,filename:r,basename:i,extname:a}};var Ot=(...e)=>{e=e.map(r=>r==="."?xe:r===".."?Ye:r);let t=e.reduce((r,o)=>{let n=r.pop(),s=Nt(n,C),i=s?n:n+C;if(!s){let a=K(o,xe),p=K(o,Ye);a?o="."+o:p&&(o=Ye+o)}return r.push(i,o),r},[C]);return t.shift(),Mt(t.join(""))},ee=(...e)=>Ot(...e.map(S)),br=(e,t=Ze)=>{let r=R(e)?()=>e:e;return(...o)=>{let n=o.findLastIndex(t);return n>=0?o=o.slice(n):o.unshift(k(r())),Ot(...o)}},pe=(e,t=Ze)=>{R(e)&&(e=S(e));let r=R(e)?()=>e:()=>S(e()),o=br(r,t);return(...n)=>o(...n.map(S))};var u;(function(e){e[e.DENO=0]="DENO",e[e.BUN=1]="BUN",e[e.NODE=2]="NODE",e[e.CHROMIUM=3]="CHROMIUM",e[e.EXTENSION=4]="EXTENSION",e[e.WEB=5]="WEB",e[e.WORKER=6]="WORKER"})(u||(u={}));var E=bt,wr={[u.DENO]:()=>!!E.Deno?.version,[u.BUN]:()=>!!E.Bun?.version,[u.NODE]:()=>!!E.process?.versions,[u.CHROMIUM]:()=>!!E.chrome?.runtime,[u.EXTENSION]:()=>!!E.browser?.runtime,[u.WEB]:()=>!!E.window?.document,[u.WORKER]:()=>!!(_e(E.self)&&he(E.WorkerGlobalScope)&&E.self instanceof E.WorkerGlobalScope)},Er=[u.DENO,u.BUN,u.NODE,u.CHROMIUM,u.EXTENSION,u.WEB,u.WORKER],et=()=>{for(let e of Er)if(wr[e]())return e;throw new Error(P.ERROR?`failed to detect current javascript runtime!
please report this issue to "https://github.com/omar-azmi/kitchensink_ts/issues", along with information on your runtime environment.`:"")},Pr=e=>{switch(e){case u.DENO:return E.Deno;case u.BUN:return E.Bun;case u.NODE:return E.process;case u.CHROMIUM:return E.chrome;case u.EXTENSION:return E.browser;case u.WEB:return E.window;case u.WORKER:return E.self;default:throw new Error(P.ERROR?`an invalid runtime enum was provided: "${e}".`:"")}},tt=(e,t=!0)=>{let r=Pr(e);if(!r)throw new Error(P.ERROR?`the requested runtime associated with the enum "${e}" is undefined (i.e. you're running on a different runtime from the provided enum).`:"");switch(e){case u.DENO:case u.BUN:case u.NODE:return S(r.cwd());case u.CHROMIUM:case u.EXTENSION:return r.runtime.getURL("");case u.WEB:case u.WORKER:return new URL("./",t?r.location.href:r.location.origin).href}};var rt=e=>{let t=[];e.forEach(n=>{t.push(...n)});let r=new Map([...new Set(t)].map(n=>[n,new Set])),o=de(r);for(let[n,s]of e)s.forEach(i=>o(i).add(n));return r},te=class{constructor(t,r){let o=t??(r?rt(r):new Map),n=r??(t?rt(t):new Map),s=Je(o),i=Je(n),a=Be(o),p=Be(n),c=o.size,m=n.size,h=He(o),b=He(n),f=de(o),x=de(n),y=Ke(o),w=Ke(n),N=Ve(o),Y=Ve(n),F=Xe(o),H=Xe(n),ne=Ge(o),Z=Ge(n),se=(l,...g)=>{let _=f(l)??(s(l,new Set)&&f(l)),M=We(_),L=Ue(_);for(let D of g)M(D)||(L(D),x(D)?.add(l)||i(D,new Set([l])))},le=(l,...g)=>{let _=x(l)??(i(l,new Set)&&x(l)),M=We(_),L=Ue(_);for(let D of g)M(D)||(L(D),f(D)?.add(l)||s(D,new Set([l])))},me=()=>{o.clear(),n.clear()},Ae=(l,g=!1)=>{let _=f(l);if(_){for(let M of _)x(M).delete(l);g?_.clear():g=a(l)}return g},ie=(l,g=!1)=>{let _=x(l);if(_){for(let M of _)f(M).delete(l);g?_.clear():g=p(l)}return g};$e(this,{fmap:o,rmap:n,size:c,rsize:m,forEach:h,rforEach:b,get:f,rget:x,has:y,rhas:w,entries:N,rentries:Y,keys:F,rkeys:H,values:ne,rvalues:Z,add:se,radd:le,clear:me,delete:Ae,rdelete:ie,remove:(l,...g)=>{let _=f(l);if(_){let M=ze(_);for(let L of g)M(L)&&x(L).delete(l)}},rremove:(l,...g)=>{let _=x(l);if(_){let M=ze(_);for(let L of g)M(L)&&f(L).delete(l)}},set:(l,g)=>(Ae(l,!0),se(l,...g),this),rset:(l,g)=>(ie(l,!0),le(l,...g),this),[De]:N,[Et]:"InvertibleMap"})}};var be=class{wmap=new WeakMap;smap=new Map;pick(t){return he(t)?this.wmap:this.smap}get(t){return this.pick(t).get(t)}set(t,r){return this.pick(t).set(t,r),this}has(t){return this.pick(t).has(t)}delete(t){return this.pick(t).delete(t)}},Rr=Symbol(P.MINIFY||"represents an unset value for a tree");function nt(e){if(new.target)throw new TypeError("Cannot create an instance: parse is not a constructor");return new ot(e).parse()}var ot=class{#s=new Set(` 	\r
`);#a=new Set([..."[]{}:,/",...this.#s]);#e;#r;#o;constructor(t){this.#e=`${t}`,this.#r=this.#e.length,this.#o=this.#p()}parse(){let t=this.#t(),r=this.#n(t),{done:o,value:n}=this.#o.next();if(!o)throw new SyntaxError(W(n));return r}#t(){let{done:t,value:r}=this.#o.next();if(t)throw new SyntaxError("Cannot parse JSONC: unexpected end of JSONC input");return r}*#p(){for(let t=0;t<this.#r;t++)if(!this.#s.has(this.#e[t])){if(this.#e[t]==="/"&&this.#e[t+1]==="*"){t+=2;let r=!1;for(;t<this.#r;t++)if(this.#e[t]==="*"&&this.#e[t+1]==="/"){r=!0;break}if(!r)throw new SyntaxError("Cannot parse JSONC: unexpected end of JSONC input");t++;continue}if(this.#e[t]==="/"&&this.#e[t+1]==="/"){for(t+=2;t<this.#r&&!(this.#e[t]===`
`||this.#e[t]==="\r");t++);continue}switch(this.#e[t]){case"{":yield{type:"BeginObject",position:t};break;case"}":yield{type:"EndObject",position:t};break;case"[":yield{type:"BeginArray",position:t};break;case"]":yield{type:"EndArray",position:t};break;case":":yield{type:"NameSeparator",position:t};break;case",":yield{type:"ValueSeparator",position:t};break;case'"':{let r=t,o=!1;for(t++;t<this.#r&&!(this.#e[t]==='"'&&!o);t++)o=this.#e[t]==="\\"&&!o;yield{type:"String",sourceText:this.#e.substring(r,t+1),position:r};break}default:{let r=t;for(;t<this.#r&&!this.#a.has(this.#e[t]);t++);t--,yield{type:"NullOrTrueOrFalseOrNumber",sourceText:this.#e.substring(r,t+1),position:r}}}}}#n(t){switch(t.type){case"BeginObject":return this.#c();case"BeginArray":return this.#l();case"NullOrTrueOrFalseOrNumber":return this.#m(t);case"String":return this.#i(t);default:throw new SyntaxError(W(t))}}#c(){let t={};for(;;){let r=this.#t();if(r.type==="EndObject")return t;if(r.type!=="String")throw new SyntaxError(W(r));let o=this.#i(r),n=this.#t();if(n.type!=="NameSeparator")throw new SyntaxError(W(n));let s=this.#t();Object.defineProperty(t,o,{value:this.#n(s),writable:!0,enumerable:!0,configurable:!0});let i=this.#t();if(i.type==="EndObject")return t;if(i.type!=="ValueSeparator")throw new SyntaxError(W(i))}}#l(){let t=[];for(;;){let r=this.#t();if(r.type==="EndArray")return t;t.push(this.#n(r));let o=this.#t();if(o.type==="EndArray")return t;if(o.type!=="ValueSeparator")throw new SyntaxError(W(o))}}#i(t){let r;try{r=JSON.parse(t.sourceText)}catch{throw new SyntaxError(W(t))}if(typeof r!="string")throw new TypeError(`Parsed value is not a string: ${r}`);return r}#m(t){if(t.sourceText==="null")return null;if(t.sourceText==="true")return!0;if(t.sourceText==="false")return!1;let r;try{r=JSON.parse(t.sourceText)}catch{throw new SyntaxError(W(t))}if(typeof r!="number")throw new TypeError(`Parsed value is not a number: ${r}`);return r}};function W({type:e,sourceText:t,position:r}){let o="";switch(e){case"BeginObject":o="{";break;case"EndObject":o="}";break;case"BeginArray":o="[";break;case"EndArray":o="]";break;case"NameSeparator":o=":";break;case"ValueSeparator":o=",";break;case"NullOrTrueOrFalseOrNumber":case"String":o=30<t.length?`${t.slice(0,30)}...`:t;break}return`Cannot parse JSONC: unexpected token "${o}" in JSONC at position ${r}`}function we(e,t){if(isNaN(e)||isNaN(t))throw new Error("Cannot compare against non-numbers");return e===t?0:e<t?-1:1}function Tt(e=[],t=[]){return e.length&&!t.length?-1:!e.length&&t.length?1:0}function it(e=[],t=[]){let r=Math.max(e.length,t.length);for(let o=0;o<r;o++){let n=e[o],s=t[o];if(n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(typeof n=="string"&&typeof s=="number")return 1;if(typeof n=="number"&&typeof s=="string"||n<s)return-1;if(n>s)return 1}return 0}var re="0|[1-9]\\d*",Sr="\\d*[a-zA-Z-][a-zA-Z0-9-]*",Ir=`(?<major>${re})\\.(?<minor>${re})\\.(?<patch>${re})`,At=`(?:${re}|${Sr})`,$t=`(?:-(?<prerelease>${At}(?:\\.${At})*))`,kt="[0-9A-Za-z-]+",Lt=`(?:\\+(?<buildmetadata>${kt}(?:\\.${kt})*))`,Dt=`v?${Ir}${$t}?${Lt}?`,Ft=new RegExp(`^${Dt}$`),Ut="(?:<|>)?=?",Cr="x|X|\\*",st=`${re}|${Cr}`,Ee=`[v=\\s]*(?<major>${st})(?:\\.(?<minor>${st})(?:\\.(?<patch>${st})${$t}?${Lt}?)?)?`,zt=new RegExp(`^(?<operator>~>?|\\^|${Ut})\\s*${Ee}$`),Wt=new RegExp(`^(?<operator>${Ut})\\s*(${Dt})$|^$`);function at(e){return typeof e=="number"&&!Number.isNaN(e)&&(!Number.isFinite(e)||0<=e&&e<=Number.MAX_SAFE_INTEGER)}var pt=256;var vr=new RegExp(`^${re}$`);function I(e){return e.split(".").filter(Boolean).map(t=>{if(vr.test(t)){let r=Number(t);if(at(r))return r}return t})}function $(e){return e.split(".").filter(Boolean)}function B(e,t){let r=Number(e);if(!at(r))throw new TypeError(t);return r}function J(e){return Number.isNaN(e.major)&&Number.isNaN(e.minor)&&Number.isNaN(e.patch)&&(e.prerelease===void 0||e.prerelease.length===0)&&(e.build===void 0||e.build.length===0)}function j(e,t){return e===t?0:we(e.major,t.major)||we(e.minor,t.minor)||we(e.patch,t.patch)||Tt(e.prerelease,t.prerelease)||it(e.prerelease,t.prerelease)}function ct(e){return e.toFixed(0)}function Pe(e){let t=ct(e.major),r=ct(e.minor),o=ct(e.patch),n=e.prerelease?.join(".")??"",s=e.build?.join(".")??"";return[[`${t}.${r}.${o}`,n].filter(p=>p).join("-"),s].filter(p=>p).join("+")}function jr(e,t){if(J(t))return!0;let r=j(e,t);switch(t.operator){case"=":case void 0:return r===0;case"!=":return r!==0;case">":return r>0;case"<":return r<0;case">=":return r>=0;case"<=":return r<=0}}function Re(e,t){for(let r of t)if(!jr(e,r))return!1;if(e.prerelease&&e.prerelease.length>0){for(let r of t){if(J(r))continue;let{major:o,minor:n,patch:s,prerelease:i}=r;if(i&&i.length>0&&e.major===o&&e.minor===n&&e.patch===s)return!0}return!1}return!0}function Se(e,t){return t.some(r=>Re(e,r))}var Ie={major:Number.NaN,minor:Number.NaN,patch:Number.NaN,prerelease:[],build:[]},oe={operator:void 0,...Ie};function Bt(e,t){return j(e,t)>0}function lt(e,t){let r;for(let o of e)Se(o,t)&&(r=r&&Bt(r,o)?r:o);return r}function Nr(e){let r=e.match(Wt)?.groups;if(!r)return null;let{operator:o,prerelease:n,buildmetadata:s}=r,i=r.major?{major:B(r.major,`Cannot parse comparator ${e}: invalid major version`),minor:B(r.minor,`Cannot parse comparator ${e}: invalid minor version`),patch:B(r.patch,`Cannot parse comparator ${e}: invalid patch version`),prerelease:n?I(n):[],build:s?$(s):[]}:Ie;return{operator:o||void 0,...i}}function d(e){return!e||e.toLowerCase()==="x"||e==="*"}function Mr(e){if(!d(e.major))return d(e.minor)?{operator:">=",major:+e.major,minor:0,patch:0,prerelease:[],build:[]}:d(e.patch)?{operator:">=",major:+e.major,minor:+e.minor,patch:0,prerelease:[],build:[]}:{operator:">=",major:+e.major,minor:+e.minor,patch:+e.patch,prerelease:e.prerelease?I(e.prerelease):[],build:[]}}function Or(e){if(!d(e.major))return d(e.minor)?{operator:"<",major:+e.major+1,minor:0,patch:0,prerelease:[],build:[]}:d(e.patch)?{operator:"<",major:+e.major,minor:+e.minor+1,patch:0,prerelease:[],build:[]}:e.prerelease?{operator:"<=",major:+e.major,minor:+e.minor,patch:+e.patch,prerelease:I(e.prerelease),build:[]}:{operator:"<=",major:+e.major,minor:+e.minor,patch:+e.patch,prerelease:[],build:[]}}function Ar(e){let t=e.match(new RegExp(`^${Ee}`)),r=t?.groups;if(!r)return null;let o=t[0].length,n=e.slice(o).match(/^\s+-\s+/);if(!n)return null;let s=n[0].length,a=e.slice(o+s).match(new RegExp(`^${Ee}\\s*$`))?.groups;if(!a)return null;let p=Mr(r),c=Or(a);return[p,c].filter(Boolean)}function kr(e){let t=d(e.major),r=d(e.minor),o=d(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[oe];if(r)return[{operator:">=",major:n,minor:0,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];if(o)return n===0?[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n,minor:s+1,patch:0}]:[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];let a=I(e.prerelease??"");return n===0?s===0?[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n,minor:s,patch:i+1}]:[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n,minor:s+1,patch:0}]:[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n+1,minor:0,patch:0}]}function Tr(e){let t=d(e.major),r=d(e.minor),o=d(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[oe];if(r)return[{operator:">=",major:n,minor:0,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n,minor:s+1,patch:0}];let a=I(e.prerelease??"");return[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n,minor:s+1,patch:0}]}function $r(e){let t=d(e.major),r=d(e.minor),o=d(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[{operator:"<",major:0,minor:0,patch:0}];if(r)return o?[{operator:"<",major:n,minor:0,patch:0}]:[{operator:"<",major:n,minor:0,patch:0}];if(o)return[{operator:"<",major:n,minor:s,patch:0}];let a=I(e.prerelease??""),p=$(e.build??"");return[{operator:"<",major:n,minor:s,patch:i,prerelease:a,build:p}]}function Lr(e){let t=d(e.minor),r=d(e.patch),o=+e.major,n=+e.minor,s=+e.patch;if(t)return r?[{operator:"<",major:o+1,minor:0,patch:0}]:[{operator:"<",major:o,minor:n+1,patch:0}];if(r)return[{operator:"<",major:o,minor:n+1,patch:0}];let i=I(e.prerelease??""),a=$(e.build??"");return[{operator:"<=",major:o,minor:n,patch:s,prerelease:i,build:a}]}function Dr(e){let t=d(e.major),r=d(e.minor),o=d(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[{operator:"<",major:0,minor:0,patch:0}];if(r)return[{operator:">=",major:n+1,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s+1,patch:0}];let a=I(e.prerelease??""),p=$(e.build??"");return[{operator:">",major:n,minor:s,patch:i,prerelease:a,build:p}]}function Fr(e){let t=d(e.major),r=d(e.minor),o=d(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[oe];if(r)return o?[{operator:">=",major:n,minor:0,patch:0}]:[{operator:">=",major:n,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s,patch:0}];let a=I(e.prerelease??""),p=$(e.build??"");return[{operator:">=",major:n,minor:s,patch:i,prerelease:a,build:p}]}function Ur(e){let t=d(e.major),r=d(e.minor),o=d(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[oe];if(r)return[{operator:">=",major:n,minor:0,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n,minor:s+1,patch:0}];let a=I(e.prerelease??""),p=$(e.build??"");return[{operator:void 0,major:n,minor:s,patch:i,prerelease:a,build:p}]}function zr(e){let t=e.match(zt)?.groups;if(!t)return Nr(e);switch(t.operator){case"^":return kr(t);case"~":case"~>":return Tr(t);case"<":return $r(t);case"<=":return Lr(t);case">":return Dr(t);case">=":return Fr(t);case"=":case"":return Ur(t);default:throw new Error(`Cannot parse version range: '${t.operator}' is not a valid operator`)}}function Wr(e){return e.split(/\s+/).flatMap(zr)}function Ce(e){let t=e.replaceAll(/(?<=<|>|=|~|\^)(\s+)/g,"").split(/\s*\|\|\s*/).map(r=>Ar(r)||Wr(r));if(t.some(r=>r.includes(null)))throw new TypeError(`Cannot parse version range: range "${e}" is invalid`);return t}function ce(e){if(typeof e!="string")throw new TypeError(`Cannot parse version as version must be a string: received ${typeof e}`);if(e.length>pt)throw new TypeError(`Cannot parse version as version length is too long: length is ${e.length}, max length is ${pt}`);e=e.trim();let t=e.match(Ft)?.groups;if(!t)throw new TypeError(`Cannot parse version: ${e}`);let r=B(t.major,`Cannot parse version ${e}: invalid major version`),o=B(t.minor,`Cannot parse version ${e}: invalid minor version`),n=B(t.patch,`Cannot parse version ${e}: invalid patch version`),s=t.prerelease?I(t.prerelease):[],i=t.buildmetadata?$(t.buildmetadata):[];return{major:r,minor:o,patch:n,prerelease:s,build:i}}var G=e=>(ye(e)??"relative")!=="relative",q={redirect:"follow",cache:"force-cache"},mt=tt(et(),!0),V=pe(mt,G);var ve=(e,t)=>{e=ae(e);let r=t[e];if(r)return r;let o=Le(t).filter(n=>n.endsWith("/")).toSorted((n,s)=>s.length-n.length);for(let n of o)if(e.startsWith(n)){let s=t[n];if(!s.endsWith("/"))throw new Error(`the value ("${s}") of the matched import-map key ("${n}") for the path alias "${e}" MUST end with a trailing slash ("/") to be specification compliant.`);return e.replace(n,s)}},je=([e,t],[r,o])=>r.length-e.length,Vr={baseAliasDir:"",basePathDir:"",sort:!0,errorCheck:!0},Ne=(e,t,r)=>{let{baseAliasDir:o,basePathDir:n,errorCheck:s,sort:i}={...Vr,...r};o=ge(o,"/")??o,n=ge(n,"/")??n;let a=z(ae(e),o),p=a===""||o!==""&&a?.startsWith("/")?"."+a:a;if(p===void 0)return Ne(e,t,{baseAliasDir:"",basePathDir:n,errorCheck:s,sort:i});i&&(t=t.toSorted(je));for(let[c,m]of t){let h=z(p,c);if(h!==void 0){if(s&&c.endsWith("/")&&!m.endsWith("/"))throw new Error(`the value ("${m}") of the matched import-map key ("${c}") for the path alias "${e}" MUST end with a trailing slash ("/") to be specification compliant.`);let b=n===""||G(m)?m:ee(k(n),m);if(h==="")return b;if(c.endsWith("/"))return ee(b,X(h))}}};var Vt={base64:[],binary:[".bin",".dat"],copy:[],css:[".css"],dataurl:[],default:[],empty:[],file:[".jpg",".jpeg",".png",".gif",".svg",".webp",".bmp",".tiff",".ico",".mp4",".webm",".ogg",".avi",".mp3",".wav",".aac"],js:[".js",".mjs",".cjs"],json:[".json"],jsx:[".jsx"],"local-css":[".module.css"],text:[".txt",".html",".md",".xml",".csv"],ts:[".ts"],tsx:[".tsx"]};var Ht={base64:["application/octet-stream","application/base64"],binary:["application/octet-stream","application/binary","application/x-binary","image/vnd.microsoft.icon"],copy:["application/octet-stream","application/x-copy"],css:["text/css"],dataurl:["application/data-url","text/data-url"],default:[],empty:[],file:["application/octet-stream","application/x-file","image/jpeg","image/png","image/gif","image/svg+xml","image/webp","image/bmp","image/tiff","image/vnd.microsoft.icon","video/mp4","video/webm","video/ogg","video/x-msvideo","audio/mpeg","audio/ogg","audio/wav","audio/x-aac","audio/webm"],js:["application/javascript","text/javascript","application/x-javascript","application/ecmascript","text/ecmascript"],json:["application/json","text/json"],jsx:["application/javascript","text/javascript","application/jsx"],"local-css":["text/css","text/x-css"],text:["text/plain","text/html","text/markdown","text/xml","text/csv"],ts:["application/typescript","text/typescript"],tsx:["application/typescript","text/typescript","application/tsx"]};var Hr=O(Ht).map(([e,t])=>[e,new Set(t)]),Kr=O(Vt).map(([e,t])=>[e,new Set(t)]),Xr=new te(new Map(Hr)),Jr=new te(new Map(Kr)),Gr=e=>{let[t,...r]=e.split(";"),o=t.trim().toLowerCase();return Xr.rget(o)},qr=e=>{let t=e.endsWith(".module.css")?".module.css":Qe(e).extname;return Jr.rget(t)},Kt=e=>{let{headers:t,url:r}=e,o=t.get("content-type")??"",n=Gr(o)??new Set,s=qr(r)??new Set,i=n.intersection(s);return i.size<=0&&(i=s),i.size<=0&&(i=n),i};var ut=e=>{let{isAbsolutePath:t,namespace:r,resolvePath:o,log:n=!1,globalImportMap:s={}}=e;return async i=>{let{path:a,resolveDir:p,importer:c,namespace:m,pluginData:h={}}=i,b=m,f={...s,...h.importMap},x=h.runtimePackage,y;if(x&&!a.startsWith("./")&&!a.startsWith("../")&&(y=x.resolveImport(a)),y===void 0&&(y=ve(a,f)),y===void 0){let w=t(c)?c:ee(k(p),c);y=t(a)?S(a):o(w,X(a))}return n&&console.log(`[${r}] onResolve:`,{path:a,resolved_path:y,resolveDir:p,args:i,importMap:f}),{path:y,namespace:r,pluginData:{originalNamespace:b,...h}}}},Xt=(e,t)=>{let{log:r,namespace:o}=e,n=ut({...e,log:!1,namespace:"oazmi-unresolver-namespace-does-not-matter"});return async s=>{let{path:i,namespace:a,pluginData:{importMap:p,runtimePackage:c,originalNamespace:m,...h}={},...b}=s,{path:f,namespace:x,pluginData:y,...w}=await n({path:i,namespace:m,...b,pluginData:{importMap:p,runtimePackage:c}}),N=await t.resolve(f,{...b,namespace:m,pluginData:{importMap:p,runtimePackage:c,...h}});return r&&console.log(`[${o}] unResolve:`,{path:i,resolved_abs_path:f,naturally_resolved_result:N,rest_resolved_args:w}),{...w,...N}}},Zr=["base64","binary","copy","css","dataurl","default","empty","file","js","json","jsx","local-css","text","ts","tsx"],Jt=e=>{let{defaultLoader:t,namespace:r,acceptLoaders:o=Zr,log:n=!1}=e,s=new Set(o);return async i=>{let{path:a,pluginData:p}=i,c=v(a),m=await fetch(c,q);if(!m.ok)throw new Error(`[${r}] onLoadUrl: ERROR: network fetch response for url "${c.href}" was not ok (${m.status}). response header:
${Q(m.headers)}`);let h=Kt(m),b=s.intersection(h),f=[...b].at(0)??t,x=await m.bytes();return n&&console.log(`[${r}] onLoadUrl:`,{path:a,path_url:c.href,guessed_loaders:h,preferred_loader:f,args:i}),{contents:x,loader:f,pluginData:p}}};var Qr={acceptLoaders:void 0,defaultLoader:"copy",filters:[/^https?\:\/\//,/^file\:\/\//],globalImportMap:void 0,namespace:"oazmi-http",resolvePath:V},eo=(e={})=>{let{acceptLoaders:t,defaultLoader:r,filters:o,globalImportMap:n,namespace:s,resolvePath:i}={...Qr,...e},a={isAbsolutePath:G,namespace:s,globalImportMap:n,resolvePath:i},p={acceptLoaders:t,defaultLoader:r,namespace:s};return async c=>{let{absWorkingDir:m,outdir:h,outfile:b,entryPoints:f,write:x,loader:y}=c.initialOptions;o.forEach(w=>{c.onResolve({filter:w},ut(a))}),c.onLoad({filter:/.*/,namespace:s},Jt(p)),c.onResolve({filter:/.*/,namespace:s},Xt(a,c))}},ft=e=>({name:"oazmi-http-plugin",setup:eo(e)});var to=Symbol(),ro={importMap:{},pluginDataMarker:to,namespace:void 0},oo={filter:/.*/,inputNamespace:void 0,importMap:{},pluginDataMarker:void 0,outputNamespace:void 0},no=(e,t)=>{let{importMap:r,pluginDataMarker:o,namespace:n}={...ro,...e};return async s=>{let{path:i,pluginData:a={},...p}=s;if(a[o])return;a[o]=!0;let c=ve(i,r);if(c===void 0)return;let m=await t.resolve(c,{pluginData:a,...p});return n&&(m.namespace=n),m}},so=(e={})=>{let{filter:t,importMap:r,pluginDataMarker:o,inputNamespace:n,outputNamespace:s}={...oo,...e},i={importMap:r,pluginDataMarker:o,namespace:s};return async a=>{let{absWorkingDir:p,outdir:c,outfile:m,entryPoints:h,write:b,loader:f}=a.initialOptions;a.onResolve({filter:t,namespace:n},no(i,a))}},dt=e=>({name:"oazmi-importmap-plugin",setup:so(e)});var wa=Symbol(P.MINIFY||"a rejection by a throttled function"),Ea=Symbol(P.MINIFY||"a timeout by an awaited promiseTimeout function");var io=(e,t=!1)=>{let r=t?new be:new Map,o=fe(r,"get"),n=fe(r,"set"),s=fe(r,"has");return{fn:a=>{let p=s(a),c=p?o(a):e(a);return p||n(a,c),c},memory:r}},Gt=e=>io(e).fn;var Me=class{packageInfo;constructor(t){this.packageInfo=t}resolveExport(t,r){return Ne(t,this.exportMapSortedEntries,{sort:!1,...r})}resolveImport(t,r){return Ne(t,this.importMapSortedEntries,{sort:!1,...r})}static async fromUrl(t){t=v(t,V());let r=nt(await(await fetch(t,q)).text());return new this(r)}};var Oe=class extends Me{importMapSortedEntries;exportMapSortedEntries;getName(){return this.packageInfo.name}getVersion(){return this.packageInfo.version}constructor(t){super(t);let{exports:r={},imports:o={}}=t,n=R(r)?r.endsWith("/")?{"./":r}:{".":r}:r,s={...o};for(let[i,a]of O(s)){let p=k(i);i!==p&&!(p in s)&&(s[p]=k(a))}this.exportMapSortedEntries=O(n).toSorted(je),this.importMapSortedEntries=O(s).toSorted(je)}resolveExport(t,r){let o=this.getName(),n=this.getVersion(),{baseAliasDir:s=`jsr:${o}@${n}`,basePathDir:i=`${ht}/${o}/${n}`,...a}=r??{},p=z(t,s)?.replace(/^\/+/,"/");return p!==void 0&&(t=s+(p==="/"?"":p)),super.resolveExport(t,{baseAliasDir:s,basePathDir:i,...a})}resolveImport(t,r){let o=this.getName(),n=this.getVersion(),s=t.startsWith("./")||t.startsWith("../"),i=s?[""]:[`jsr:${o}@${n}`,`jsr:${o}`,`${o}`],a;for(let p of i)if(a=this.resolveExport(t,{...r,baseAliasDir:p}),a)break;return a??super.resolveImport(t,r)}static async fromUrl(t){if((R(t)?t:t.href).startsWith("jsr:")){let{host:n}=T(t);t=await po(`jsr:${n}`)}return super.fromUrl(t)}},ht="https://jsr.io",ao=async e=>{let{protocol:t,scope:r,pkg:o,pathname:n,version:s}=T(e);if(t!=="jsr:")throw new Error(`expected path protocol to be "jsr:", found "${t}" instead, for package: "${e}"`);if(!r)throw new Error(`expected jsr package to contain a scope, but found "${r}" instead, for package: "${e}"`);let i=v(`@${r}/${o}/meta.json`,ht),a=await(await fetch(i,q)).json(),p=O(a.versions).filter(([w,{yanked:N}])=>!N).map(([w])=>ce(w)),c=lt(p,Ce(s??a.latest));if(!c)throw new Error(`failed to find the desired version "${s}" of the jsr package "${e}", with available versions "${Q(a.versions)}"`);let m=Pe(c),h=v(`@${r}/${o}/${m}/`,ht),b=v("./deno.json",h),f=v("./jsr.json",h),x=v("./package.json",h),y=[b,f];for(let w of y)if((await fetch(w,{...q,method:"HEAD"})).ok)return w;throw new Error(`Network Error: couldn't locate "${e}"'s package json file. searched in the following locations:
${Q(y)}`)},po=Gt(ao);var co={filters:[/^jsr\:/],globalImportMap:void 0,resolvePath:V},lo=(e={})=>{let{filters:t,globalImportMap:r,resolvePath:o}={...co,...e};return async n=>{let{absWorkingDir:s,outdir:i,outfile:a,entryPoints:p,write:c,loader:m}=n.initialOptions;t.forEach(h=>{n.onResolve({filter:h},async b=>{let{path:f,pluginData:x,...y}=b,{importMap:w,runtimePackage:N,...Y}=x??{},F=await Oe.fromUrl(f),H=T(f).pathname,ne=H==="/"?".":X(H),Z=F.resolveExport(ne,{baseAliasDir:""});if(!Z)throw new Error(`failed to resolve the path "${f}" from the deno package: "jsr:${F.getName()}@${F.getVersion()}"`);return n.resolve(Z,{...y,pluginData:{importMap:r,runtimePackage:F,...Y}})})})}},_t=e=>({name:"oazmi-jsr-plugin",setup:lo(e)});var mo={specifiers:["npm:"],globalImportMap:void 0,resolvePath:V,sideEffects:"auto",autoInstall:!0},uo=!1,fo=(e={})=>{let{specifiers:t,globalImportMap:r,resolvePath:o,sideEffects:n,autoInstall:s}={...mo,...e},i=R(n)?void 0:n;return async a=>{let{absWorkingDir:p,outdir:c,outfile:m,entryPoints:h,write:b,loader:f}=a.initialOptions,x=p?k(S(p)):o("./");t.forEach(y=>{let w=new RegExp(`^${qe(y)}`);a.onResolve({filter:w},async N=>{let{path:Y,pluginData:F,resolveDir:H="",...ne}=N,Z=z(Y,y,"npm:"),{scope:se,pkg:le,pathname:me,version:Ae}=T(Z),ie=`${se?"@"+se+"/":""}${le}${me==="/"?"":me}`,ke=H===""?x:H,{importMap:qt,runtimePackage:Yt,originalNamespace:Zt,...l}=F??{},g=void 0;uo&&console.log("[oazmi-npm-specifier-plugin] onResolve:",{path:Y,resolve_dir:ke,resolved_npm_package_alias:ie,args:N});let _=await a.resolve(ie,{resolveDir:ke,...ne,pluginData:{importMap:r,runtimePackage:g,...l}});return i!==void 0&&(_.sideEffects=i),_})})}},gt=e=>({name:"oazmi-npm-specifier-plugin",setup:fo(e)});var ho={importMap:{},getCwd:mt},_o=e=>{let{importMap:t,getCwd:r}={...ho,...e},o=pe(r,G);return[dt({importMap:t}),ft({globalImportMap:t,resolvePath:o}),_t({globalImportMap:t,resolvePath:o}),gt({globalImportMap:t,resolvePath:o})]};export{_o as denoPlugins,ft as httpPlugin,dt as importMapPlugin,_t as jsrPlugin,gt as npmSpecifierPlugin};
