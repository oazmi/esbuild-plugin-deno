function bt(e,t,r){let o=r===void 0?t:t.bind(r),n=e.length-1;for(;n>=0;){if(o(e[n],n,e))return n;n--}return-1}function Pt(e,t,r){let o=e.findLastIndex(t,r);return o===-1?void 0:e[o]}Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e,t){return bt(this,e,t)});Array.prototype.findLast||(Array.prototype.findLast=function(e,t){return Pt(this,e,t)});Uint8Array.prototype.findLastIndex||(Uint8Array.prototype.findLastIndex=function(e,t){return bt(this,e,t)});Uint8Array.prototype.findLast||(Uint8Array.prototype.findLast=function(e,t){return Pt(this,e,t)});var tr={},wt=rr(globalThis,tr);function rr(e,t){return new Proxy(e,{get(r,o,n){return o in t?t[o]:e[o]},set(r,o,n){return o in t&&delete t[o],e[o]=n,!0},deleteProperty(r,o){let n=!1;return o in t&&(delete t[o],n=!0),o in e&&(delete e[o],n=!0),n},ownKeys(r){let o=Reflect.ownKeys(e),n=Reflect.ownKeys(t),s=new Set(n);return[...o.filter(i=>!s.has(i)),...n]},defineProperty(r,o,n){return o in t&&delete t[o],Reflect.defineProperty(e,o,n),!0},getOwnPropertyDescriptor(r,o){return o in t?Reflect.getOwnPropertyDescriptor(t,o):Reflect.getOwnPropertyDescriptor(e,o)},has(r,o){return o in t||o in e}})}var nr=JSON;var Te=Object;var Rt=Symbol;var ie=nr.stringify;var $e=Te.assign;var M=Te.entries;var Le=Te.keys;var Fe=Rt.iterator;var Et=Rt.toStringTag;var he=encodeURI;var St=decodeURI;var R;(function(e){e[e.LOG=0]="LOG",e[e.ASSERT=0]="ASSERT",e[e.ERROR=1]="ERROR",e[e.PRODUCTION=1]="PRODUCTION",e[e.MINIFY=1]="MINIFY"})(R||(R={}));var k=(e,t,...r)=>o=>e[t].bind(o,...r);var ge=(e,t,...r)=>e[t].bind(e,...r),Ct=e=>e.prototype;var J=Ct(Map),Ue=Ct(Set);var ze=k(Ue,"add");var We=k(Ue,"delete");var Be=k(Ue,"has");var Ve=k(J,"delete"),He=k(J,"entries"),Ke=k(J,"forEach"),_e=k(J,"get"),Xe=k(J,"has"),Je=k(J,"keys"),qe=k(J,"set"),Ge=k(J,"values");var xe=e=>{let t=typeof e;return t==="object"||t==="function"};var ye=e=>typeof e=="object";var E=e=>typeof e=="string";var cr=/[.*+?^${}()|[\]\\]/g,Ye=e=>e.replaceAll(cr,"\\$&"),q=(e,t,r="")=>e.startsWith(t)?r+e.slice(t.length):void 0,be=(e,t,r="")=>e.endsWith(t)?(t===""?e:e.slice(0,-t.length))+r:void 0;var lr=M({"node:":"node","npm:":"npm","jsr:":"jsr","blob:":"blob","data:":"data","http://":"http","https://":"https","file://":"file","./":"relative","../":"relative"}),ur=["blob","data","relative"],mr=["jsr","npm","node"],fr=["jsr:","npm:","node:"],j="/",Pe="./",Ze="../",dr=/\\/g,hr=/^[a-z]\:[\/\\]/i,gr=/^\/+/;var _r=/\/?[^\/]+$/,xr=/^(?<basename>.+?)(?<ext>\.[^\.]+)?$/,yr=/^(?<protocol>jsr:|npm:|node:)(\/*(@(?<scope>[^\/\s]+)\/)?(?<pkg>[^@\/\s]+)(@(?<version>[^\/\r\n\t\f\v]+))?)?(?<pathname>\/.*)?$/,ee=(e,t)=>e.startsWith(t),Mt=(e,t)=>e.endsWith(t),Qe=e=>ee(e,j)||ee(e,"~")||hr.test(e),we=e=>{if(!(!e||e==="")){for(let[t,r]of lr)if(ee(e,t))return r;return Qe(e)?"local":"relative"}},T=e=>{e=St(E(e)?e:e.href);let{protocol:t,scope:r,pkg:o,version:n,pathname:s}=yr.exec(e)?.groups??{};if(t===void 0||o===void 0)throw new Error(R.ERROR?"invalid package url format was provided: "+e:"");let i=r||void 0,a=n||void 0,p=s||j,c=`${i?"@"+i+j:""}${o}${a?"@"+a:""}`,l=he(`${t}/${c}${p}`);return{protocol:t,scope:i,pkg:o,version:a,pathname:p,host:c,href:l}},C=(e,t)=>{if(!E(e))return e;e=S(e);let r=t;if(E(t)){let s=we(t);if(ur.includes(s))throw new Error(R.ERROR?"the following base scheme (url-protocol) is not supported: "+s:"");r=C(t)}let o=we(e),n=mr.includes(o);if(o==="local")return new URL("file://"+he(e));if(n)return new URL(T(e).href);if(o==="relative"){let s=r?r.protocol:void 0;if(!fr.includes(s))return new URL(he(e),r);let{protocol:a,host:p,pathname:c}=T(r),l=new URL(e,"x:"+c).pathname;e=`${a}/${p}${l}`}return new URL(e)},br=e=>e.replace(gr,"");var te=e=>ee(e,Pe)?e:ee(e,j)?"."+e:Pe+e,D=e=>Mt(e,j)?e:e+j;var kt=(e,t={})=>{let{keepRelative:r=!0}=ye(t)?t:{},o=e.split(j),n=o.at(-1),s=[".."],i=r&&o[0]===".";o.length>=2&&(n==="."||n==="..")&&o.push("");for(let p of o)p===".."?s.at(-1)!==".."?s.pop():s.push(p):p!=="."&&s.push(p);return s.shift(),i&&s[0]!==".."&&s.unshift("."),s.join(j)},$=(e,t)=>kt(S(e),t),S=e=>e.replaceAll(dr,j);var Nt=e=>br(_r.exec(e)?.[0]??""),Pr=e=>{let{basename:t="",ext:r=""}=xr.exec(e)?.groups??{};return[t,r]},et=e=>{let t=$(e),r=Nt(t),o=r.length,n=o>0?t.slice(0,-o):t,s=Nt(n.slice(0,-1)),[i,a]=Pr(r);return{path:t,dirpath:n,dirname:s,filename:r,basename:i,extname:a}};var Dt=(...e)=>{e=e.map(r=>r==="."?Pe:r===".."?Ze:r);let t=e.reduce((r,o)=>{let n=r.pop(),s=Mt(n,j),i=s?n:n+j;if(!s){let a=ee(o,Pe),p=ee(o,Ze);a?o="."+o:p&&(o=Ze+o)}return r.push(i,o),r},[j]);return t.shift(),kt(t.join(""))},ae=(...e)=>Dt(...e.map(S)),wr=(e,t=Qe)=>{let r=E(e)?()=>e:e;return(...o)=>{let n=o.findLastIndex(t);return n>=0?o=o.slice(n):o.unshift(D(r())),Dt(...o)}},fe=(e,t=Qe)=>{E(e)&&(e=S(e));let r=E(e)?()=>e:()=>S(e()),o=wr(r,t);return(...n)=>o(...n.map(S))};var f;(function(e){e[e.DENO=0]="DENO",e[e.BUN=1]="BUN",e[e.NODE=2]="NODE",e[e.CHROMIUM=3]="CHROMIUM",e[e.EXTENSION=4]="EXTENSION",e[e.WEB=5]="WEB",e[e.WORKER=6]="WORKER"})(f||(f={}));var w=wt,Rr={[f.DENO]:()=>!!w.Deno?.version,[f.BUN]:()=>!!w.Bun?.version,[f.NODE]:()=>!!w.process?.versions,[f.CHROMIUM]:()=>!!w.chrome?.runtime,[f.EXTENSION]:()=>!!w.browser?.runtime,[f.WEB]:()=>!!w.window?.document,[f.WORKER]:()=>!!(ye(w.self)&&xe(w.WorkerGlobalScope)&&w.self instanceof w.WorkerGlobalScope)},Er=[f.DENO,f.BUN,f.NODE,f.CHROMIUM,f.EXTENSION,f.WEB,f.WORKER],tt=()=>{for(let e of Er)if(Rr[e]())return e;throw new Error(R.ERROR?`failed to detect current javascript runtime!
please report this issue to "https://github.com/omar-azmi/kitchensink_ts/issues", along with information on your runtime environment.`:"")},Sr=e=>{switch(e){case f.DENO:return w.Deno;case f.BUN:return w.Bun;case f.NODE:return w.process;case f.CHROMIUM:return w.chrome;case f.EXTENSION:return w.browser;case f.WEB:return w.window;case f.WORKER:return w.self;default:throw new Error(R.ERROR?`an invalid runtime enum was provided: "${e}".`:"")}},rt=(e,t=!0)=>{let r=Sr(e);if(!r)throw new Error(R.ERROR?`the requested runtime associated with the enum "${e}" is undefined (i.e. you're running on a different runtime from the provided enum).`:"");switch(e){case f.DENO:case f.BUN:case f.NODE:return S(r.cwd());case f.CHROMIUM:case f.EXTENSION:return r.runtime.getURL("");case f.WEB:case f.WORKER:return new URL("./",t?r.location.href:r.location.origin).href}};var ot=e=>{let t=[];e.forEach(n=>{t.push(...n)});let r=new Map([...new Set(t)].map(n=>[n,new Set])),o=_e(r);for(let[n,s]of e)s.forEach(i=>o(i).add(n));return r},pe=class{constructor(t,r){let o=t??(r?ot(r):new Map),n=r??(t?ot(t):new Map),s=qe(o),i=qe(n),a=Ve(o),p=Ve(n),c=o.size,l=n.size,m=Ke(o),h=Ke(n),d=_e(o),g=_e(n),b=Xe(o),P=Xe(n),v=He(o),Z=He(n),A=Je(o),U=Je(n),H=Ge(o),K=Ge(n),z=(u,...y)=>{let x=d(u)??(s(u,new Set)&&d(u)),N=Be(x),W=ze(x);for(let B of y)N(B)||(W(B),g(B)?.add(u)||i(B,new Set([u])))},Q=(u,...y)=>{let x=g(u)??(i(u,new Set)&&g(u)),N=Be(x),W=ze(x);for(let B of y)N(B)||(W(B),d(B)?.add(u)||s(B,new Set([u])))},ne=()=>{o.clear(),n.clear()},se=(u,y=!1)=>{let x=d(u);if(x){for(let N of x)g(N).delete(u);y?x.clear():y=a(u)}return y},X=(u,y=!1)=>{let x=g(u);if(x){for(let N of x)d(N).delete(u);y?x.clear():y=p(u)}return y};$e(this,{fmap:o,rmap:n,size:c,rsize:l,forEach:m,rforEach:h,get:d,rget:g,has:b,rhas:P,entries:v,rentries:Z,keys:A,rkeys:U,values:H,rvalues:K,add:z,radd:Q,clear:ne,delete:se,rdelete:X,remove:(u,...y)=>{let x=d(u);if(x){let N=We(x);for(let W of y)N(W)&&g(W).delete(u)}},rremove:(u,...y)=>{let x=g(u);if(x){let N=We(x);for(let W of y)N(W)&&d(W).delete(u)}},set:(u,y)=>(se(u,!0),z(u,...y),this),rset:(u,y)=>(X(u,!0),Q(u,...y),this),[Fe]:v,[Et]:"InvertibleMap"})}};var Re=class{wmap=new WeakMap;smap=new Map;pick(t){return xe(t)?this.wmap:this.smap}get(t){return this.pick(t).get(t)}set(t,r){return this.pick(t).set(t,r),this}has(t){return this.pick(t).has(t)}delete(t){return this.pick(t).delete(t)}},Cr=Symbol(R.MINIFY||"represents an unset value for a tree");function st(e){if(new.target)throw new TypeError("Cannot create an instance: parse is not a constructor");return new nt(e).parse()}var nt=class{#s=new Set(` 	\r
`);#a=new Set([..."[]{}:,/",...this.#s]);#e;#r;#o;constructor(t){this.#e=`${t}`,this.#r=this.#e.length,this.#o=this.#p()}parse(){let t=this.#t(),r=this.#n(t),{done:o,value:n}=this.#o.next();if(!o)throw new SyntaxError(G(n));return r}#t(){let{done:t,value:r}=this.#o.next();if(t)throw new SyntaxError("Cannot parse JSONC: unexpected end of JSONC input");return r}*#p(){for(let t=0;t<this.#r;t++)if(!this.#s.has(this.#e[t])){if(this.#e[t]==="/"&&this.#e[t+1]==="*"){t+=2;let r=!1;for(;t<this.#r;t++)if(this.#e[t]==="*"&&this.#e[t+1]==="/"){r=!0;break}if(!r)throw new SyntaxError("Cannot parse JSONC: unexpected end of JSONC input");t++;continue}if(this.#e[t]==="/"&&this.#e[t+1]==="/"){for(t+=2;t<this.#r&&!(this.#e[t]===`
`||this.#e[t]==="\r");t++);continue}switch(this.#e[t]){case"{":yield{type:"BeginObject",position:t};break;case"}":yield{type:"EndObject",position:t};break;case"[":yield{type:"BeginArray",position:t};break;case"]":yield{type:"EndArray",position:t};break;case":":yield{type:"NameSeparator",position:t};break;case",":yield{type:"ValueSeparator",position:t};break;case'"':{let r=t,o=!1;for(t++;t<this.#r&&!(this.#e[t]==='"'&&!o);t++)o=this.#e[t]==="\\"&&!o;yield{type:"String",sourceText:this.#e.substring(r,t+1),position:r};break}default:{let r=t;for(;t<this.#r&&!this.#a.has(this.#e[t]);t++);t--,yield{type:"NullOrTrueOrFalseOrNumber",sourceText:this.#e.substring(r,t+1),position:r}}}}}#n(t){switch(t.type){case"BeginObject":return this.#c();case"BeginArray":return this.#l();case"NullOrTrueOrFalseOrNumber":return this.#u(t);case"String":return this.#i(t);default:throw new SyntaxError(G(t))}}#c(){let t={};for(;;){let r=this.#t();if(r.type==="EndObject")return t;if(r.type!=="String")throw new SyntaxError(G(r));let o=this.#i(r),n=this.#t();if(n.type!=="NameSeparator")throw new SyntaxError(G(n));let s=this.#t();Object.defineProperty(t,o,{value:this.#n(s),writable:!0,enumerable:!0,configurable:!0});let i=this.#t();if(i.type==="EndObject")return t;if(i.type!=="ValueSeparator")throw new SyntaxError(G(i))}}#l(){let t=[];for(;;){let r=this.#t();if(r.type==="EndArray")return t;t.push(this.#n(r));let o=this.#t();if(o.type==="EndArray")return t;if(o.type!=="ValueSeparator")throw new SyntaxError(G(o))}}#i(t){let r;try{r=JSON.parse(t.sourceText)}catch{throw new SyntaxError(G(t))}if(typeof r!="string")throw new TypeError(`Parsed value is not a string: ${r}`);return r}#u(t){if(t.sourceText==="null")return null;if(t.sourceText==="true")return!0;if(t.sourceText==="false")return!1;let r;try{r=JSON.parse(t.sourceText)}catch{throw new SyntaxError(G(t))}if(typeof r!="number")throw new TypeError(`Parsed value is not a number: ${r}`);return r}};function G({type:e,sourceText:t,position:r}){let o="";switch(e){case"BeginObject":o="{";break;case"EndObject":o="}";break;case"BeginArray":o="[";break;case"EndArray":o="]";break;case"NameSeparator":o=":";break;case"ValueSeparator":o=",";break;case"NullOrTrueOrFalseOrNumber":case"String":o=30<t.length?`${t.slice(0,30)}...`:t;break}return`Cannot parse JSONC: unexpected token "${o}" in JSONC at position ${r}`}function Ee(e,t){if(isNaN(e)||isNaN(t))throw new Error("Cannot compare against non-numbers");return e===t?0:e<t?-1:1}function $t(e=[],t=[]){return e.length&&!t.length?-1:!e.length&&t.length?1:0}function at(e=[],t=[]){let r=Math.max(e.length,t.length);for(let o=0;o<r;o++){let n=e[o],s=t[o];if(n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(typeof n=="string"&&typeof s=="number")return 1;if(typeof n=="number"&&typeof s=="string"||n<s)return-1;if(n>s)return 1}return 0}var ce="0|[1-9]\\d*",Ir="\\d*[a-zA-Z-][a-zA-Z0-9-]*",vr=`(?<major>${ce})\\.(?<minor>${ce})\\.(?<patch>${ce})`,At=`(?:${ce}|${Ir})`,Lt=`(?:-(?<prerelease>${At}(?:\\.${At})*))`,Tt="[0-9A-Za-z-]+",Ft=`(?:\\+(?<buildmetadata>${Tt}(?:\\.${Tt})*))`,Ut=`v?${vr}${Lt}?${Ft}?`,zt=new RegExp(`^${Ut}$`),Wt="(?:<|>)?=?",jr="x|X|\\*",it=`${ce}|${jr}`,Se=`[v=\\s]*(?<major>${it})(?:\\.(?<minor>${it})(?:\\.(?<patch>${it})${Lt}?${Ft}?)?)?`,Bt=new RegExp(`^(?<operator>~>?|\\^|${Wt})\\s*${Se}$`),Vt=new RegExp(`^(?<operator>${Wt})\\s*(${Ut})$|^$`);function pt(e){return typeof e=="number"&&!Number.isNaN(e)&&(!Number.isFinite(e)||0<=e&&e<=Number.MAX_SAFE_INTEGER)}var ct=256;var Or=new RegExp(`^${ce}$`);function I(e){return e.split(".").filter(Boolean).map(t=>{if(Or.test(t)){let r=Number(t);if(pt(r))return r}return t})}function L(e){return e.split(".").filter(Boolean)}function Y(e,t){let r=Number(e);if(!pt(r))throw new TypeError(t);return r}function re(e){return Number.isNaN(e.major)&&Number.isNaN(e.minor)&&Number.isNaN(e.patch)&&(e.prerelease===void 0||e.prerelease.length===0)&&(e.build===void 0||e.build.length===0)}function O(e,t){return e===t?0:Ee(e.major,t.major)||Ee(e.minor,t.minor)||Ee(e.patch,t.patch)||$t(e.prerelease,t.prerelease)||at(e.prerelease,t.prerelease)}function lt(e){return e.toFixed(0)}function Ce(e){let t=lt(e.major),r=lt(e.minor),o=lt(e.patch),n=e.prerelease?.join(".")??"",s=e.build?.join(".")??"";return[[`${t}.${r}.${o}`,n].filter(p=>p).join("-"),s].filter(p=>p).join("+")}function Nr(e,t){if(re(t))return!0;let r=O(e,t);switch(t.operator){case"=":case void 0:return r===0;case"!=":return r!==0;case">":return r>0;case"<":return r<0;case">=":return r>=0;case"<=":return r<=0}}function Ie(e,t){for(let r of t)if(!Nr(e,r))return!1;if(e.prerelease&&e.prerelease.length>0){for(let r of t){if(re(r))continue;let{major:o,minor:n,patch:s,prerelease:i}=r;if(i&&i.length>0&&e.major===o&&e.minor===n&&e.patch===s)return!0}return!1}return!0}function ve(e,t){return t.some(r=>Ie(e,r))}var je={major:Number.NaN,minor:Number.NaN,patch:Number.NaN,prerelease:[],build:[]},le={operator:void 0,...je};function Ht(e,t){return O(e,t)>0}function ut(e,t){let r;for(let o of e)ve(o,t)&&(r=r&&Ht(r,o)?r:o);return r}function Mr(e){let r=e.match(Vt)?.groups;if(!r)return null;let{operator:o,prerelease:n,buildmetadata:s}=r,i=r.major?{major:Y(r.major,`Cannot parse comparator ${e}: invalid major version`),minor:Y(r.minor,`Cannot parse comparator ${e}: invalid minor version`),patch:Y(r.patch,`Cannot parse comparator ${e}: invalid patch version`),prerelease:n?I(n):[],build:s?L(s):[]}:je;return{operator:o||void 0,...i}}function _(e){return!e||e.toLowerCase()==="x"||e==="*"}function kr(e){if(!_(e.major))return _(e.minor)?{operator:">=",major:+e.major,minor:0,patch:0,prerelease:[],build:[]}:_(e.patch)?{operator:">=",major:+e.major,minor:+e.minor,patch:0,prerelease:[],build:[]}:{operator:">=",major:+e.major,minor:+e.minor,patch:+e.patch,prerelease:e.prerelease?I(e.prerelease):[],build:[]}}function Dr(e){if(!_(e.major))return _(e.minor)?{operator:"<",major:+e.major+1,minor:0,patch:0,prerelease:[],build:[]}:_(e.patch)?{operator:"<",major:+e.major,minor:+e.minor+1,patch:0,prerelease:[],build:[]}:e.prerelease?{operator:"<=",major:+e.major,minor:+e.minor,patch:+e.patch,prerelease:I(e.prerelease),build:[]}:{operator:"<=",major:+e.major,minor:+e.minor,patch:+e.patch,prerelease:[],build:[]}}function Ar(e){let t=e.match(new RegExp(`^${Se}`)),r=t?.groups;if(!r)return null;let o=t[0].length,n=e.slice(o).match(/^\s+-\s+/);if(!n)return null;let s=n[0].length,a=e.slice(o+s).match(new RegExp(`^${Se}\\s*$`))?.groups;if(!a)return null;let p=kr(r),c=Dr(a);return[p,c].filter(Boolean)}function Tr(e){let t=_(e.major),r=_(e.minor),o=_(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[le];if(r)return[{operator:">=",major:n,minor:0,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];if(o)return n===0?[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n,minor:s+1,patch:0}]:[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];let a=I(e.prerelease??"");return n===0?s===0?[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n,minor:s,patch:i+1}]:[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n,minor:s+1,patch:0}]:[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n+1,minor:0,patch:0}]}function $r(e){let t=_(e.major),r=_(e.minor),o=_(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[le];if(r)return[{operator:">=",major:n,minor:0,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n,minor:s+1,patch:0}];let a=I(e.prerelease??"");return[{operator:">=",major:n,minor:s,patch:i,prerelease:a},{operator:"<",major:n,minor:s+1,patch:0}]}function Lr(e){let t=_(e.major),r=_(e.minor),o=_(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[{operator:"<",major:0,minor:0,patch:0}];if(r)return o?[{operator:"<",major:n,minor:0,patch:0}]:[{operator:"<",major:n,minor:0,patch:0}];if(o)return[{operator:"<",major:n,minor:s,patch:0}];let a=I(e.prerelease??""),p=L(e.build??"");return[{operator:"<",major:n,minor:s,patch:i,prerelease:a,build:p}]}function Fr(e){let t=_(e.minor),r=_(e.patch),o=+e.major,n=+e.minor,s=+e.patch;if(t)return r?[{operator:"<",major:o+1,minor:0,patch:0}]:[{operator:"<",major:o,minor:n+1,patch:0}];if(r)return[{operator:"<",major:o,minor:n+1,patch:0}];let i=I(e.prerelease??""),a=L(e.build??"");return[{operator:"<=",major:o,minor:n,patch:s,prerelease:i,build:a}]}function Ur(e){let t=_(e.major),r=_(e.minor),o=_(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[{operator:"<",major:0,minor:0,patch:0}];if(r)return[{operator:">=",major:n+1,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s+1,patch:0}];let a=I(e.prerelease??""),p=L(e.build??"");return[{operator:">",major:n,minor:s,patch:i,prerelease:a,build:p}]}function zr(e){let t=_(e.major),r=_(e.minor),o=_(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[le];if(r)return o?[{operator:">=",major:n,minor:0,patch:0}]:[{operator:">=",major:n,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s,patch:0}];let a=I(e.prerelease??""),p=L(e.build??"");return[{operator:">=",major:n,minor:s,patch:i,prerelease:a,build:p}]}function Wr(e){let t=_(e.major),r=_(e.minor),o=_(e.patch),n=+e.major,s=+e.minor,i=+e.patch;if(t)return[le];if(r)return[{operator:">=",major:n,minor:0,patch:0},{operator:"<",major:n+1,minor:0,patch:0}];if(o)return[{operator:">=",major:n,minor:s,patch:0},{operator:"<",major:n,minor:s+1,patch:0}];let a=I(e.prerelease??""),p=L(e.build??"");return[{operator:void 0,major:n,minor:s,patch:i,prerelease:a,build:p}]}function Br(e){let t=e.match(Bt)?.groups;if(!t)return Mr(e);switch(t.operator){case"^":return Tr(t);case"~":case"~>":return $r(t);case"<":return Lr(t);case"<=":return Fr(t);case">":return Ur(t);case">=":return zr(t);case"=":case"":return Wr(t);default:throw new Error(`Cannot parse version range: '${t.operator}' is not a valid operator`)}}function Vr(e){return e.split(/\s+/).flatMap(Br)}function Oe(e){let t=e.replaceAll(/(?<=<|>|=|~|\^)(\s+)/g,"").split(/\s*\|\|\s*/).map(r=>Ar(r)||Vr(r));if(t.some(r=>r.includes(null)))throw new TypeError(`Cannot parse version range: range "${e}" is invalid`);return t}function de(e){if(typeof e!="string")throw new TypeError(`Cannot parse version as version must be a string: received ${typeof e}`);if(e.length>ct)throw new TypeError(`Cannot parse version as version length is too long: length is ${e.length}, max length is ${ct}`);e=e.trim();let t=e.match(zt)?.groups;if(!t)throw new TypeError(`Cannot parse version: ${e}`);let r=Y(t.major,`Cannot parse version ${e}: invalid major version`),o=Y(t.minor,`Cannot parse version ${e}: invalid minor version`),n=Y(t.patch,`Cannot parse version ${e}: invalid patch version`),s=t.prerelease?I(t.prerelease):[],i=t.buildmetadata?L(t.buildmetadata):[];return{major:r,minor:o,patch:n,prerelease:s,build:i}}var V=e=>(we(e)??"relative")!=="relative",oe={redirect:"follow",cache:"force-cache"},mt=rt(tt(),!0),F=fe(mt,V);var Ne=(e,t)=>{e=$(e);let r=t[e];if(r)return r;let o=Le(t).filter(n=>n.endsWith("/")).toSorted((n,s)=>s.length-n.length);for(let n of o)if(e.startsWith(n)){let s=t[n];if(!s.endsWith("/"))throw new Error(`the value ("${s}") of the matched import-map key ("${n}") for the path alias "${e}" MUST end with a trailing slash ("/") to be specification compliant.`);return e.replace(n,s)}},Me=([e,t],[r,o])=>r.length-e.length,Kr={baseAliasDir:"",basePathDir:"",sort:!0,errorCheck:!0},ke=(e,t,r)=>{let{baseAliasDir:o,basePathDir:n,errorCheck:s,sort:i}={...Kr,...r};o=be(o,"/")??o,n=be(n,"/")??n;let a=q($(e),o),p=a===""||o!==""&&a?.startsWith("/")?"."+a:a;if(p===void 0)return ke(e,t,{baseAliasDir:"",basePathDir:n,errorCheck:s,sort:i});i&&(t=t.toSorted(Me));for(let[c,l]of t){let m=q(p,c);if(m!==void 0){if(s&&c.endsWith("/")&&!l.endsWith("/"))throw new Error(`the value ("${l}") of the matched import-map key ("${c}") for the path alias "${e}" MUST end with a trailing slash ("/") to be specification compliant.`);let h=n===""||V(l)?l:ae(D(n),l);if(m==="")return h;if(c.endsWith("/"))return ae(h,te(m))}}};var Kt={base64:[],binary:[".bin",".dat"],copy:[],css:[".css"],dataurl:[],default:[],empty:[],file:[".jpg",".jpeg",".png",".gif",".svg",".webp",".bmp",".tiff",".ico",".mp4",".webm",".ogg",".avi",".mp3",".wav",".aac"],js:[".js",".mjs",".cjs"],json:[".json"],jsx:[".jsx"],"local-css":[".module.css"],text:[".txt",".html",".md",".xml",".csv"],ts:[".ts"],tsx:[".tsx"]};var Xt={base64:["application/octet-stream","application/base64"],binary:["application/octet-stream","application/binary","application/x-binary","image/vnd.microsoft.icon"],copy:["application/octet-stream","application/x-copy"],css:["text/css"],dataurl:["application/data-url","text/data-url"],default:[],empty:[],file:["application/octet-stream","application/x-file","image/jpeg","image/png","image/gif","image/svg+xml","image/webp","image/bmp","image/tiff","image/vnd.microsoft.icon","video/mp4","video/webm","video/ogg","video/x-msvideo","audio/mpeg","audio/ogg","audio/wav","audio/x-aac","audio/webm"],js:["application/javascript","text/javascript","application/x-javascript","application/ecmascript","text/ecmascript"],json:["application/json","text/json"],jsx:["application/javascript","text/javascript","application/jsx"],"local-css":["text/css","text/x-css"],text:["text/plain","text/html","text/markdown","text/xml","text/csv"],ts:["application/typescript","text/typescript"],tsx:["application/typescript","text/typescript","application/tsx"]};var Xr=M(Xt).map(([e,t])=>[e,new Set(t)]),Jr=M(Kt).map(([e,t])=>[e,new Set(t)]),qr=new pe(new Map(Xr)),Gr=new pe(new Map(Jr)),Yr=e=>{let[t,...r]=e.split(";"),o=t.trim().toLowerCase();return qr.rget(o)},Zr=e=>{let t=e.endsWith(".module.css")?".module.css":et(e).extname;return Gr.rget(t)},Jt=e=>{let{headers:t,url:r}=e,o=t.get("content-type")??"",n=Yr(o)??new Set,s=Zr(r)??new Set,i=n.intersection(s);return i.size<=0&&(i=s),i.size<=0&&(i=n),i};var ft=e=>{let{isAbsolutePath:t,namespace:r,resolvePath:o,log:n=!1,globalImportMap:s={}}=e;return async i=>{let{path:a,resolveDir:p,importer:c,namespace:l,pluginData:m={}}=i,h=l,d={...s,...m.importMap},g=m.runtimePackage,b;if(g&&!a.startsWith("./")&&!a.startsWith("../")&&(b=g.resolveImport(a)),b===void 0&&(b=Ne(a,d)),b===void 0){let P=t(c)?c:ae(D(p),c);b=t(a)?S(a):o(P,te(a))}return n&&console.log(`[${r}] onResolve:`,{path:a,resolved_path:b,resolveDir:p,args:i,importMap:d}),{path:b,namespace:r,pluginData:{originalNamespace:h,...m}}}},De=(e,t)=>{let{log:r,namespace:o}=e,n=ft({...e,log:!1,namespace:"oazmi-unresolver-namespace-does-not-matter"});return async s=>{let{path:i,namespace:a,pluginData:{importMap:p,runtimePackage:c,originalNamespace:l,...m}={},...h}=s,{path:d,namespace:g,pluginData:b,...P}=await n({path:i,namespace:l,...h,pluginData:{importMap:p,runtimePackage:c}}),v=await t.resolve(d,{...h,namespace:l,pluginData:{importMap:p,runtimePackage:c,...m}});return r&&console.log(`[${o}] unResolve:`,{path:i,resolved_abs_path:d,naturally_resolved_result:v,rest_resolved_args:P}),{...P,...v}}},eo=["base64","binary","copy","css","dataurl","default","empty","file","js","json","jsx","local-css","text","ts","tsx"],qt=e=>{let{defaultLoader:t,namespace:r,acceptLoaders:o=eo,log:n=!1}=e,s=new Set(o);return async i=>{let{path:a,pluginData:p}=i,c=C(a),l=await fetch(c,oe);if(!l.ok)throw new Error(`[${r}] onLoadUrl: ERROR: network fetch response for url "${c.href}" was not ok (${l.status}). response header:
${ie(l.headers)}`);let m=Jt(l),h=s.intersection(m),d=[...h].at(0)??t,g=await l.bytes();return n&&console.log(`[${r}] onLoadUrl:`,{path:a,path_url:c.href,guessed_loaders:m,preferred_loader:d,args:i}),{contents:g,loader:d,pluginData:p}}};var to={acceptLoaders:void 0,defaultLoader:"copy",filters:[/^https?\:\/\//,/^file\:\/\//],globalImportMap:void 0,namespace:"oazmi-http",resolvePath:F},ro=(e={})=>{let{acceptLoaders:t,defaultLoader:r,filters:o,globalImportMap:n,namespace:s,resolvePath:i}={...to,...e},a={isAbsolutePath:V,namespace:s,globalImportMap:n,resolvePath:i},p={acceptLoaders:t,defaultLoader:r,namespace:s};return async c=>{let{absWorkingDir:l,outdir:m,outfile:h,entryPoints:d,write:g,loader:b}=c.initialOptions;o.forEach(P=>{c.onResolve({filter:P},ft(a))}),c.onLoad({filter:/.*/,namespace:s},qt(p)),c.onResolve({filter:/.*/,namespace:s},De(a,c))}},dt=e=>({name:"oazmi-http-plugin",setup:ro(e)});var oo=Symbol(),no={importMap:{},pluginDataMarker:oo,namespace:void 0},so={filter:/.*/,inputNamespace:void 0,importMap:{},pluginDataMarker:void 0,outputNamespace:void 0},io=(e,t)=>{let{importMap:r,pluginDataMarker:o,namespace:n}={...no,...e};return async s=>{let{path:i,pluginData:a={},...p}=s;if(a[o])return;a[o]=!0;let c=Ne(i,r);if(c===void 0)return;let l=await t.resolve(c,{pluginData:a,...p});return n&&(l.namespace=n),l}},ao=(e={})=>{let{filter:t,importMap:r,pluginDataMarker:o,inputNamespace:n,outputNamespace:s}={...so,...e},i={importMap:r,pluginDataMarker:o,namespace:s};return async a=>{let{absWorkingDir:p,outdir:c,outfile:l,entryPoints:m,write:h,loader:d}=a.initialOptions;a.onResolve({filter:t,namespace:n},io(i,a))}},ht=e=>({name:"oazmi-importmap-plugin",setup:ao(e)});var ue=class{packagePath;packageInfo;constructor(t,r){this.packageInfo=t,this.packagePath=r}getPath(){return this.packagePath}resolveExport(t,r){return ke(t,this.exportMapSortedEntries,{sort:!1,...r})}resolveImport(t,r){return ke(t,this.importMapSortedEntries,{sort:!1,...r})}static async fromUrl(t){t=C(t,F());let r=st(await(await fetch(t,oe)).text());return new this(r,t.href)}};var Ma=Symbol(R.MINIFY||"a rejection by a throttled function"),ka=Symbol(R.MINIFY||"a timeout by an awaited promiseTimeout function");var po=(e,t=!1)=>{let r=t?new Re:new Map,o=ge(r,"get"),n=ge(r,"set"),s=ge(r,"has");return{fn:a=>{let p=s(a),c=p?o(a):e(a);return p||n(a,c),c},memory:r}},Gt=e=>po(e).fn;var me=class extends ue{importMapSortedEntries;exportMapSortedEntries;getName(){return this.packageInfo.name}getVersion(){return this.packageInfo.version}getPath(){let t=this.packagePath;return t||`${gt}/${this.getName()}/${this.getVersion()}/deno.json`}constructor(t,r){super(t,r);let{exports:o={},imports:n={}}=t,s=E(o)?o.endsWith("/")?{"./":o}:{".":o}:o,i={...n};for(let[a,p]of M(i)){let c=D(a);a!==c&&!(c in i)&&(i[c]=D(p))}this.exportMapSortedEntries=M(s).toSorted(Me),this.importMapSortedEntries=M(i).toSorted(Me)}resolveExport(t,r){let o=this.getName(),n=this.getVersion(),s=S(this.getPath()),{baseAliasDir:i=`jsr:${o}@${n}`,basePathDir:a=$(s.endsWith("/")?s:s+"/../"),...p}=r??{},c=q(t,i)?.replace(/^\/+/,"/");return c!==void 0&&(t=i+(c==="/"?"":c)),super.resolveExport(t,{baseAliasDir:i,basePathDir:a,...p})}resolveImport(t,r){let o=this.getName(),n=this.getVersion(),s=t.startsWith("./")||t.startsWith("../"),i=s?[""]:[`jsr:${o}@${n}`,`jsr:${o}`,`${o}`],a;for(let p of i)if(a=this.resolveExport(t,{...r,baseAliasDir:p}),a)break;return a??super.resolveImport(t,r)}static async fromUrl(t){if((E(t)?t:t.href).startsWith("jsr:")){let{host:n}=T(t);t=await lo(`jsr:${n}`)}return super.fromUrl(t)}},gt="https://jsr.io",co=async e=>{let{protocol:t,scope:r,pkg:o,pathname:n,version:s}=T(e);if(t!=="jsr:")throw new Error(`expected path protocol to be "jsr:", found "${t}" instead, for package: "${e}"`);if(!r)throw new Error(`expected jsr package to contain a scope, but found "${r}" instead, for package: "${e}"`);let i=C(`@${r}/${o}/meta.json`,gt),a=await(await fetch(i,oe)).json(),p=M(a.versions).filter(([P,{yanked:v}])=>!v).map(([P])=>de(P)),c=ut(p,Oe(s??a.latest));if(!c)throw new Error(`failed to find the desired version "${s}" of the jsr package "${e}", with available versions "${ie(a.versions)}"`);let l=Ce(c),m=C(`@${r}/${o}/${l}/`,gt),h=C("./deno.json",m),d=C("./jsr.json",m),g=C("./package.json",m),b=[h,d];for(let P of b)if((await fetch(P,{...oe,method:"HEAD"})).ok)return P;throw new Error(`Network Error: couldn't locate "${e}"'s package json file. searched in the following locations:
${ie(b)}`)},lo=Gt(co);var uo=Symbol(),Yt={pluginData:{},pluginDataMarker:uo,captureDependencies:!0,onResolveArgs:{}},mo={...Yt,filters:[/.*/],namespace:void 0},fo=(e,t)=>{let{pluginData:r,pluginDataMarker:o,captureDependencies:n,onResolveArgs:s}={...Yt,...e},i=new Set;return async a=>{let{path:p,pluginData:c={},...l}=a,m={...r,...c},{kind:h,importer:d}=l;if(h!=="entry-point"&&!i.has($(d))||m[o])return;m[o]=!0;let g=await t.resolve(p,{...l,...s,pluginData:m});return g.pluginData===void 0&&(g.pluginData=m),n&&i.add($(g.path)),{...g,pluginData:m}}};var ho={...mo,resolvePath:F,isAbsolutePath:V},go=(e={})=>{let{filters:t,namespace:r,...o}={...ho,...e},{isAbsolutePath:n,resolvePath:s,log:i,globalImportMap:a,...p}=o,{pluginData:c,...l}=p,m=_o({isAbsolutePath:n,resolvePath:s},c);return async h=>{let{absWorkingDir:d,outdir:g,outfile:b,entryPoints:P,write:v,loader:Z}=h.initialOptions,A=await m,U={...l,pluginData:A};t.forEach(H=>{h.onResolve({filter:H,namespace:r},fo(U,h)),h.onResolve({filter:H,namespace:r},async K=>{let{path:z,pluginData:Q={},...ne}=K,se=Q.runtimePackage;if(se&&!z.startsWith("./")&&!z.startsWith("../")){let X=se.resolveImport(z);if(X)return h.resolve(X,{...ne,pluginData:Q,namespace:"oazmi-temp-namespace-1"})}}),h.onResolve({filter:/.*/,namespace:"oazmi-temp-namespace-1"},De({isAbsolutePath:n,resolvePath:s,namespace:""},h))})}},_t=e=>({name:"oazmi-deno-initialdata-plugin",setup:go(e)}),_o=async(e,t={})=>{let{isAbsolutePath:r,resolvePath:o}=e,{runtimePackage:n}=t,s=n===void 0?void 0:n instanceof ue?n:await me.fromUrl(E(n)?C(r(n)?n:o(n)):n);return{...t,runtimePackage:s}};var xo={filters:[/^jsr\:/],globalImportMap:void 0,resolvePath:F},yo=(e={})=>{let{filters:t,globalImportMap:r,resolvePath:o}={...xo,...e};return async n=>{let{absWorkingDir:s,outdir:i,outfile:a,entryPoints:p,write:c,loader:l}=n.initialOptions;t.forEach(m=>{n.onResolve({filter:m},async h=>{let{path:d,pluginData:g,...b}=h,{importMap:P,runtimePackage:v,...Z}=g??{},A=await me.fromUrl(d),U=T(d).pathname,H=U==="/"?".":te(U),K=A.resolveExport(H,{baseAliasDir:""});if(!K)throw new Error(`failed to resolve the path "${d}" from the deno package: "jsr:${A.getName()}@${A.getVersion()}"`);return n.resolve(K,{...b,pluginData:{importMap:r,runtimePackage:A,...Z}})})})}},xt=e=>({name:"oazmi-jsr-plugin",setup:yo(e)});var bo={specifiers:["npm:"],globalImportMap:void 0,resolvePath:F,sideEffects:"auto",autoInstall:!0},Po=!1,wo=(e={})=>{let{specifiers:t,globalImportMap:r,resolvePath:o,sideEffects:n,autoInstall:s}={...bo,...e},i=E(n)?void 0:n;return async a=>{let{absWorkingDir:p,outdir:c,outfile:l,entryPoints:m,write:h,loader:d}=a.initialOptions,g=p?D(S(p)):o("./");t.forEach(b=>{let P=new RegExp(`^${Ye(b)}`);a.onResolve({filter:P},async v=>{let{path:Z,pluginData:A,resolveDir:U="",...H}=v,K=q(Z,b,"npm:"),{scope:z,pkg:Q,pathname:ne,version:se}=T(K),X=`${z?"@"+z+"/":""}${Q}${ne==="/"?"":ne}`,Ae=U===""?g:U,{importMap:Zt,runtimePackage:Qt,originalNamespace:er,...u}=A??{},y=void 0;Po&&console.log("[oazmi-npm-specifier-plugin] onResolve:",{path:Z,resolve_dir:Ae,resolved_npm_package_alias:X,args:v});let x=await a.resolve(X,{resolveDir:Ae,...H,pluginData:{importMap:r,runtimePackage:y,...u}});return i!==void 0&&(x.sideEffects=i),x})})}},yt=e=>({name:"oazmi-npm-specifier-plugin",setup:wo(e)});var Ro={runtimePackage:void 0,importMap:{},getCwd:mt},Eo=e=>{let{runtimePackage:t,importMap:r,getCwd:o}={...Ro,...e},n=fe(o,V);return[_t({pluginData:{runtimePackage:t}}),ht({importMap:r}),dt({globalImportMap:r,resolvePath:n}),xt({globalImportMap:r,resolvePath:n}),yt({globalImportMap:r,resolvePath:n})]};export{_t as denoInitialDataPlugin,Eo as denoPlugins,dt as httpPlugin,ht as importMapPlugin,xt as jsrPlugin,yt as npmSpecifierPlugin};
